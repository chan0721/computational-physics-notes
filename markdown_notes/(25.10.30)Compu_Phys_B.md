# (25.10.30) Computational Physics B

## class 1

- implicit method (continued)
      - $\vec{y}^{n+1} = \vec{y}^n + \Delta t \cdot \vec{f}(t^{n+1}, \vec{y}^{n+1}) $
      - guess a solution first, $\vec{y}_0^{n+1}$, and then $ \vec{y}^{n+1} = \vec{y}_0^{n+1} + \Delta \vec{y}_0$, and do Taylor expansion:
        - $ \vec{f}(t^{n+1}, \vec{y}^{n+1}) = \vec{f}(t^{n+1}, \vec{y}_0^{n+1}) + \left. \frac{\partial \vec{f}}{\partial \vec{y}} \right|_{\vec{y}_0^{n+1}} \Delta \vec{y}_0 + ... $
        - then substitute into the implicit equation: 
          - $ \vec{y}_0^{n+1} + \Delta \vec{y}_0 = \vec{y}^n + \Delta t \left[ \vec{f}(t^{n+1}, \vec{y}_0^{n+1}) + \left. \frac{\partial \vec{f}}{\partial \vec{y}} \right|_{\vec{y}_0^{n+1}} \Delta \vec{y}_0 \right] $ and solve for $ \Delta \vec{y}_0 $.
          - then we can get a better approximation of $ \vec{y}^{n+1} $, and repeat the process until $|\frac{\Delta \vec{y_k}}{\vec{y_k}}| < \epsilon $. 

- How to solve PDE?
  - linear advection
    - $ \frac{\partial a}{\partial t} + u \frac{\partial a}{\partial x} = 0 $
    - solution: $ a(x, t) = a(x - ut, 0) $, this depicts a wave moving to the right without changing its shape, so it's "linear", and the solution consists of a straight line in the x-t plane -- characteristics.
  - 1st order finite difference method (FDM)
    - $ \frac{a_i^{n+1} - a_i^n}{\Delta t} + u \frac{a_{i}^n - a_{i-1}^n}{\Delta x} = 0 $ -- explicit method
      - where n is time step and i is spatial index.
    - numerical stability
      - define Courant number $ c = \frac{u \Delta t}{\Delta x} $, then $a_i^{n+1} = a_i^n + c_{i-1}^n $
      - Conside a single Fourier mode: $ a_i^n = A^n e^{I i \theta} $, where $ \theta = k \Delta x $, and $k$ is the wavenumber.
      - then $ A^{n+1} = A^n((1 - c + c \cos \theta) - (I c \sin \theta)) $, then the magnitude of the amplification is $ | \frac{A^{n+1}}{A^n} | = \sqrt{(1 - c + c \cos \theta)^2 + (c \sin \theta)^2} = \sqrt{1 - 2c(1-c)(1 - \cos \theta)} $
      - the error increases monotonically without bound and will cause numerical instability if $ | \frac{A^{n+1}}{A^n} | > 1 $. And to avoid this instability, we need $ c \leq 1 $, which is the Courant-Friedrichs-Lewy (CFL) condition.
      - This means physically that the wave cannot travel more than one grid cell in one time step. The maximum wave speed sets the upper limit on the time step $\Delta t$. 
      - As a simple example, if we doubles the spatial resolution in a 3D simulation, the computational cost increases by a factor of 16: $ 2^3 $ from the number of grid cells and another factor of 2 from the CFL condition on the time step.

## class 2

- method revisited
  - "upwind" scheme
    - $ \frac{a_i^{n+1} - a_i^n}{\Delta t} + u \frac{a_{i}^n - a_{i-1}^n}{\Delta x} = 0 $ , for $ u > 0 $
    - $ \frac{a_i^{n+1} - a_i^n}{\Delta t} + u \frac{a_{i+1}^n - a_{i}^n}{\Delta x} = 0 $ , for $ u < 0 $
    - we need to consider the direction of "information flow", if we do not do this way, the numerical simulation may crush.
  - 2nd order finite difference method
    -  time forward, centered space (FTCS) -- $ \frac{\partial a}{\partial x} \sim \frac{a_{i+1}-a_{i-1}}{2 \Delta x} $
    -  stability analysis shows that this method is unconditionally unstable for linear advection equation since it mixes upwind and downwind information flow. Therefore, this will cause unphysical oscillations.

- second and higher order advection equation with finite-volume method (FVM)
  - advantages
    - conservation is ensured
    - shocks are accurately treated -- so almost all astrophysical fluid simulation codes employ FVM
  - basic equation
    - $ \frac{\partial}{\partial t} <a_i> = - \frac{F(a)_{i+1/2} - F(a)_{i-1/2}}{\Delta x} $, the volume-averaged quantity depends on the flux through the boundary of the zone.
  - second-order predictor-corrector scheme
    - $ \frac{a_i^{n+1} - a_i^n}{\Delta t} = - \frac{F(a)_{i+1/2}^{n+1/2} - F(a)_{i-1/2}^{n+1/2}}{\Delta x} $ -- predictor step
      - where flux at the half time step is equal to state at half time step: $ F(a)_{i+1/2}^{n+1/2} = F(a_{i+1/2}^{n+1/2}) $, while the state can be calculated by Taylor expansion
        - $ a_{i+1/2,l}^{n+1/2} = a_i^n + \frac{\Delta x}{2} \left( \frac{\partial a}{\partial x} \right)_i^n + \frac{\Delta t}{2} \left( \frac{\partial a}{\partial t} \right)_i^n $
        - $ a_{i+1/2,r}^{n+1/2} = a_{i+1}^n - \frac{\Delta x}{2} \left( \frac{\partial a}{\partial x} \right)_{i+1}^n + \frac{\Delta t}{2} \left( \frac{\partial a}{\partial t} \right)_{i+1}^n $

        - the core question now turns to how to calculate the spatial derivative $ \frac{\partial a}{\partial x} $, and we can use "reconstruction" method to do this. 
